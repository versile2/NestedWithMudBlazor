@page "/Nested_DG"

<MudDataGrid T="GetExerciseTemplateDto" Items="getExercises" EditMode="DataGridEditMode.Form"
             Bordered="true" Dense="true" EditTrigger="DataGridEditTrigger.OnRowClick">
    <Columns>
        <PropertyColumn Property="x => x.Number" />
        <PropertyColumn Property="x => x.Name" />
        <PropertyColumn Property="x => x.Description" />
        <TemplateColumn>
            <CellTemplate>
                <MudText Typo="Typo.body1">
                    @string.Join(", ", context.Item.Types.Select(t => t.Type))
                </MudText>
            </CellTemplate>
            <EditTemplate>
                <MudSelect T="GetExerciseTypeDto" @bind-SelectedValues="context.Item.Types"
                           MultiSelection="true">
                    @foreach (var exerciseType in allExerciseTypes)
                    {
                        <MudSelectItem T="GetExerciseTypeDto" Value="exerciseType">
                            @exerciseType.Type
                        </MudSelectItem>
                    }
                </MudSelect>
            </EditTemplate>
        </TemplateColumn>
    </Columns>
</MudDataGrid>

@code {
    protected override void OnInitialized()
    {

        base.OnInitialized();
    }


    List<GetExerciseTypeDto> allExerciseTypes = new List<GetExerciseTypeDto>
    {
        new GetExerciseTypeDto { Id = 1, Type = "Run" },
        new GetExerciseTypeDto { Id = 2, Type = "Bike" },
        new GetExerciseTypeDto { Id = 3, Type = "Swim" }
    };

    IEnumerable<GetExerciseTemplateDto> getExercises = new List<GetExerciseTemplateDto>
    {
        new GetExerciseTemplateDto
        {
            Id = 1,
            Number = 101,
            Name = "Exercise 101",
            Description = "This is a description of Exercise 101.",
            Types = new List<GetExerciseTypeDto>
            {
                new GetExerciseTypeDto
                {
                    Id = 1,
                    Type = "Run"
                },
                new GetExerciseTypeDto
                {
                    Id = 2,
                    Type = "Bike"
                }
            }
        },
        new GetExerciseTemplateDto
        {
            Id = 2,
            Number = 102,
            Name = "Exercise 102",
            Description = "This is a description of Exercise 102.",
            Types = new List<GetExerciseTypeDto>
            {
                new GetExerciseTypeDto
                {
                    Id = 3,
                    Type = "Swim"
                }
            }
        }
    };

    public class GetExerciseTemplateDto
    {
        public int Id { get; set; }
        public int Number { get; set; }
        public string Name { get; set; }
        public string Description { get; set; }
        public IEnumerable<GetExerciseTypeDto> Types { get; set; }
    }

    public class GetExerciseTypeDto
    {
        public int Id { get; set; }
        public string Type { get; set; }
    }
}
